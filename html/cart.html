<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ</title>
    <link rel="stylesheet" href="../css/customCSS/cart.css">
    <link rel="stylesheet" href="../css/customCSS/all.css">
    <link rel="stylesheet" href="../css/fontawesome/fontawesomepro6.4.2.css">
    <link rel="stylesheet" href="../css/swiper-bundle.min.css">
    <link rel="stylesheet" href="../css/bootstrap/bootstrap.css">
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <script src="../js/fontawesome6.7.2.js"></script>
    <script src="../js/swiper-bundle.min.js"></script>
</head>

<body>
    <div class="container-fluid p-0">
        <header>
            <a href="../html/home.html"><img class="logo" src="../img/logo.webp" alt="Logo"></a>
            <form action="#">
                <input type="text" name="search" id="search" placeholder="Tìm kiếm sản phẩm ...">
                <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>
            <div class="header-right">
                <div class="call">
                    <i class="fa-solid fa-phone-volume" style="color: #ffffff;"></i>
                    <a href="#">
                        <small>Gọi mua hàng</small><br>
                        <small>1900 1234</small>
                    </a>
                </div>
                <div class="login">
                    <i class="fa-regular fa-user"></i>
                    <span>
                        <a href="#"><small>Tài khoản</small></a><br>
                        <a href="../html/login.html"><small>Đăng nhập</small></a>
                    </span>
                </div>
                <a href="../html/cart.html" class="cart-wrapper">
                    <div class="cart" id="cart">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <small>Giỏ hàng</small>
                    </div>
                </a>
            </div>
        </header>
        <nav>
            <ul>
                <li>
                    <i class="fa-solid fa-list"></i> DANH MỤC SẢN PHẨM
                    <ul class="submenu">
                        <li><a href="../html/CategoryCamera.html">Máy ảnh</a></li>
                        <li><a href="../html/CategoryLens.html">Ống kính</a></li>
                        <li><a href="../html/CategoryCamcorder.html">Máy quay phim</a></li>
                        <li><a href="../html/CategoryAccessories.html">Phụ kiện máy ảnh</a></li>
                        <li><a href="../html/CategoryDrone.html">Drone</a></li>
                    </ul>
                </li>
                <li class="active"><a href="../html/home.html">Trang chủ</a></li>
                <li><a href="../html/introduction.html">Giới thiệu</a></li>
                <li>
                    <a href="../html/allProducts.html">Sản phẩm</a>
                    <ul class="submenu-products">
                        <li><a href="../html/newProducts.html">Sản phẩm mới</a></li>
                        <li><a href="../html/featuredProducts.html">Sản phẩm nổi bật</a></li>
                    </ul>
                </li>
                <li><a href="../html/contact.html">Liên hệ</a></li>
            </ul>
        </nav>
        <div class="cart-info-wrapper">
            <div class="cart-info-title">Giỏ hàng của bạn</div>
            <div class=""></div>
            <table id="cart-table" class="table table-bordered w-75">
                <thead>
                    <tr>
                        <th>Thông tin sản phẩm</th>
                        <th>Đơn giá</th>
                        <th>Số lượng</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- <tr>
                        <td>
                            <div class="cart-item">
                                <img width="108" height="108"
                                    src="../img/products/Camera/canon-eos-5d-mark-iv-500x500.webp" alt="">
                                <div>
                                    <p>Máy ảnh Nikon D850 (Body Only)</p>
                                    <a href="#">Xóa</a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="price-box">
                                <span class="price">50.990.000₫</span>
                                <span class="compare-price">57.990.000₫</span>
                            </div>
                        </td>
                        <td><input type="number" class="form-control"></td>
                        <td>50.990.000₫</td>
                    </tr> -->

                    <!-- Sẽ được thêm bằng JS -->
            </table>
            <div class="total-price">
                <div class="total">Tổng tiền: 50.990.000₫</div>
                <button type="button" class="btn btn-outline-primary">
                    Thanh toán
                </button>
            </div>
        </div>
        <footer>
            <div class="footer-wrapper">
                <div class="footer-info">
                    <div class="footer-logo">
                        <img src="../img/logo-footer.webp" alt="Logo">
                    </div>
                    <div class="item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M4.58867 13.1879C2.56119 12.5189 2.44466 9.69477 4.41012 8.86094L17.7759 3.19061C19.691 2.37814 21.6219 4.30899 20.8094 6.22409L15.1391 19.5899C14.3052 21.5553 11.4811 21.4388 10.8121 19.4113L9.26792 14.7321L4.58867 13.1879Z"
                                stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <p>Địa chỉ</p>
                    </div>
                    <div class="item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M6.42459 3.23775C7.51203 2.76707 8.77662 3.00825 9.61449 3.84612L9.9591 4.19073C11.0636 5.29519 11.3313 6.98519 10.6223 8.37694L9.97022 9.65693C9.58386 10.4153 9.72975 11.3363 10.3316 11.9381L12.0619 13.6684C12.6637 14.2702 13.5847 14.4161 14.3431 14.0298L15.6231 13.3777C17.0148 12.6687 18.7048 12.9364 19.8093 14.0409L20.1539 14.3855C20.9918 15.2234 21.2329 16.488 20.7623 17.5754C19.4986 20.4948 16.2974 21.9789 13.6038 20.2867C11.9845 19.2694 10.0931 17.8454 8.12386 15.8761C6.15459 13.9069 4.73063 12.0155 3.71332 10.3962C2.02107 7.70255 3.50523 4.50135 6.42459 3.23775Z"
                                stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <p>1900 xxxx</p>
                    </div>
                    <div class="item">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M4 6.35418C4.73294 5.52375 5.80531 5 7 5H17C18.0144 5 18.9407 5.37764 19.6458 6M4 6.35418C3.37764 7.05931 3 7.98555 3 9V15C3 17.2091 4.79086 19 7 19H17C19.2091 19 21 17.2091 21 15V9C21 7.80531 20.4762 6.73294 19.6458 6M4 6.35418L12 13L19.6458 6"
                                stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <p>support@example.com</p>
                    </div>
                </div>
                <div class="footer-about">
                    <div class="footer-about-title">
                        VỀ CHÚNG TÔI
                    </div>
                    <ul>
                        <li><a href="../html/home.html">Trang chủ</a></li>
                        <li><a href="../html/introduction.html">Giới thiệu</a></li>
                        <li><a href="../html/allProducts.html">Sản phẩm</a></li>
                        <li><a href="../html/contact.html">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="footer-policy">
                    <div class="footer-about-title">
                        CHÍNH SÁCH
                    </div>
                    <ul>
                        <li><a href="#">Chính sách giao hàng</a></li>
                        <li><a href="#">Chính sách đổi trả</a></li>
                        <li><a href="#">Chính sách bán hàng</a></li>
                        <li><a href="#">Hướng dẫn trả góp</a></li>
                    </ul>
                </div>
                <div class="footer-advise-payment-wrapper">
                    <div class="footer-advise">
                        <div class="footer-advise-title">
                            TƯ VẤN KHÁCH HÀNG
                        </div>
                        <ul>
                            <li><a href="#">Mua hàng: 1900 6750</a></li>
                            <li><a href="#">Khiếu nại: 1900 6750</a></li>
                            <li><a href="#">Bảo hành: 1900 6750</a></li>
                        </ul>
                    </div>
                    <div class="footer-payment">
                        <div class="footer-payment-title">
                            PHƯƠNG THỨC THANH TOÁN
                        </div>
                        <div class="footer-payment-list">
                            <img src="../img/payment/icon_payment_1.webp" alt="Payment">
                            <img src="../img/payment/icon_payment_2.webp" alt="Payment">
                            <img src="../img/payment/icon_payment_3.webp" alt="Payment">
                            <img src="../img/payment/icon_payment_4.webp" alt="Payment">
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
<script>
    function createCartRow(product) {
        // product là object có các thuộc tính: name, image, price, comparePrice, quantity

        // Tạo phần tử tr
        const tr = document.createElement('tr');

        tr.innerHTML = `
        <td>
            <div class="cart-item">
                <img width="108" height="108" src="${product.image}" alt="">
                <div>
                    <p>${product.name}</p>
                    <a href="#" onclick="removeCartItem(this)">Xóa</a>
                </div>
            </div>
        </td>
        <td>
            <div class="price-box">
                <span class="price">${product.price}</span>
                <span class="compare-price">${product.comparePrice}</span>
            </div>
        </td>
        <td><input type="number" class="form-control" value="${product.quantity}" onchange="updateTotal(this)"></td>
        <td class="line-total">${product.price}</td>
    `;

        return tr;
    }

    function formatCurrency(value) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(value);
    }

    function updateTotal(input) {
        const row = input.closest("tr");
        const priceText = row.querySelector(".price").textContent.replace(/[^\d]/g, "");
        let quantity = parseInt(input.value);

        if (isNaN(quantity) || quantity < 0) {
            quantity = 1;
            input.value = 1;
        }

        if (quantity === 0) {
            row.remove();

            // Cập nhật localStorage khi xóa sản phẩm
            cartProducts = cartProducts.filter(p => p.name !== name);
            localStorage.setItem("cart", JSON.stringify(cartProducts));

            updateCartTotal();
            return;
        }

        const lineTotal = parseInt(priceText) * quantity;

        row.querySelector(".line-total").textContent = formatCurrency(lineTotal);

        // Cập nhật số lượng trong localStorage
        const name = row.querySelector("p").textContent;
        const product = cartProducts.find(p => p.name === name);
        if (product) {
            product.quantity = quantity;
            localStorage.setItem("cart", JSON.stringify(cartProducts));
        }

        updateCartTotal(); // Cập nhật lại tổng tiền toàn bộ
    }

    function updateCartTotal() {
        const rows = document.querySelectorAll("#cart-table tbody tr");
        const totalBox = document.querySelector(".total-price");
        let total = 0;

        if (rows.length === 0) {
            // Nếu không có sản phẩm
            totalBox.style.display = "none";

            // Hiển thị thông báo
            const cartInfoWrapper = document.querySelector(".cart-info-wrapper");
            let emptyMsg = cartInfoWrapper.querySelector(".empty-cart-msg");

            if (!emptyMsg) {
                emptyMsg = document.createElement("div");
                emptyMsg.className = "empty-cart-msg";
                emptyMsg.textContent = "Không có sản phẩm trong giỏ hàng.";
                cartInfoWrapper.appendChild(emptyMsg);
            }

            return;
        }

        // Có sản phẩm → xóa thông báo nếu có
        const existingMsg = document.querySelector(".empty-cart-msg");
        if (existingMsg) {
            existingMsg.remove();
        }

        totalBox.style.display = "block";

        rows.forEach(row => {
            const priceText = row.querySelector(".price").textContent.replace(/[^\d]/g, "");
            const quantity = row.querySelector("input[type='number']").value;
            const lineTotal = parseInt(priceText) * parseInt(quantity);

            row.querySelector(".line-total").textContent = formatCurrency(lineTotal);
            total += lineTotal;
        });

        document.querySelector(".total").textContent = `Tổng tiền: ${formatCurrency(total)}`;
    }

    function removeCartItem(link) {
        const row = link.closest('tr');
        const name = row.querySelector("p").textContent;

        // Xóa dòng khỏi DOM
        row.remove();

        // Xóa khỏi mảng cartProducts và cập nhật localStorage
        cartProducts = cartProducts.filter(p => p.name !== name);
        localStorage.setItem("cart", JSON.stringify(cartProducts));

        updateCartTotal();
    }
    const cartTableBody = document.querySelector("#cart-table tbody");
    let cartProducts = JSON.parse(localStorage.getItem("cart")) || [];

    cartProducts.forEach(product => {
        const newRow = createCartRow(product);
        cartTableBody.appendChild(newRow);
    });
    updateCartTotal();

</script>

</html>